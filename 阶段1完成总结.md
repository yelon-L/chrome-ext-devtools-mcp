# é˜¶æ®µ1å®Œæˆï¼šæ•°æ®åº“è¿ç§»æ¡†æ¶é›†æˆ

**å®Œæˆæ—¶é—´**: 2025-10-14 20:00  
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“Š å®Œæˆæ¦‚è§ˆ

```
é˜¶æ®µ0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  85% 
é˜¶æ®µ1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  100% âœ…
é˜¶æ®µ2: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%

æ€»è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  35% (3/8å¤©)
```

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. æ•°æ®åº“é…ç½®æ›´æ–° âœ…

**é»˜è®¤æ•°æ®åº“**: `mcp_dev` â†’ `extdebugdb`

**ä¿®æ”¹æ–‡ä»¶**: `scripts/db-migrate.ts`

```typescript
database: process.env.POSTGRES_DB || 'extdebugdb',
```

---

### 2. ä¾èµ–å®‰è£… âœ…

**å®‰è£…å‘½ä»¤**: `pnpm install --save node-pg-migrate`

**ç»“æœ**: 
```
Already up to date
Done in 2.7s using pnpm v10.18.2
```

**ä¾èµ–å·²å­˜åœ¨**ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚

---

### 3. è¿ç§»æ–‡ä»¶æ›´æ–° âœ…

**æ–‡ä»¶**: `src/multi-tenant/storage/migrations/001-initial-schema.sql`

**æ›´æ–°å†…å®¹**: åŒ¹é…å®é™…çš„è¡¨ç»“æ„

#### ç”¨æˆ·è¡¨ (mcp_users)
```sql
CREATE TABLE IF NOT EXISTS mcp_users (
  user_id VARCHAR(255) PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(255) NOT NULL,              -- ä¿®æ”¹: NOT NULL
  registered_at BIGINT NOT NULL,
  updated_at BIGINT,                           -- ä¿®æ”¹: å¯é€‰
  metadata JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP  -- æ–°å¢
);
```

#### æµè§ˆå™¨è¡¨ (mcp_browsers)
```sql
CREATE TABLE IF NOT EXISTS mcp_browsers (
  browser_id UUID PRIMARY KEY,                 -- ä¿®æ”¹: VARCHAR â†’ UUID
  user_id VARCHAR(255) NOT NULL,
  browser_url VARCHAR(2048) NOT NULL,          -- ä¿®æ”¹: debug_url â†’ browser_url
  token_name VARCHAR(255) NOT NULL,            -- æ–°å¢
  token VARCHAR(255) UNIQUE NOT NULL,
  created_at_ts BIGINT NOT NULL,               -- ä¿®æ”¹: bound_at â†’ created_at_ts
  last_connected_at BIGINT,
  tool_call_count INTEGER DEFAULT 0,           -- æ–°å¢
  metadata JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- æ–°å¢
  FOREIGN KEY (user_id) REFERENCES mcp_users(user_id) ON DELETE CASCADE
);
```

---

### 4. PostgreSQLStorageAdapter é›†æˆè¿ç§»æ¡†æ¶ âœ…

**æ–‡ä»¶**: `src/multi-tenant/storage/PostgreSQLStorageAdapter.ts`

#### 4.1 å¯¼å…¥è¿ç§»ç›¸å…³æ¨¡å—
```typescript
import fs from 'node:fs';
import path from 'node:path';
import {fileURLToPath} from 'node:url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
```

#### 4.2 æ·»åŠ è¿ç§»é…ç½®å±æ€§
```typescript
export class PostgreSQLStorageAdapter implements StorageAdapter {
  private pool: pg.Pool;
  private config: PostgreSQLConfig;
  private logger = createLogger('PostgreSQL');
  private migrationsDir = path.join(__dirname, 'migrations');
  private migrationsTable = 'pgmigrations';
  // ...
}
```

#### 4.3 ä¿®æ”¹ initialize() æ–¹æ³•
```typescript
async initialize(): Promise<void> {
  this.logger.info('åˆå§‹åŒ–æ•°æ®åº“è¿æ¥', {
    host: this.config.host,
    port: this.config.port,
    database: this.config.database,
  });

  try {
    // æµ‹è¯•è¿æ¥
    const client = await this.pool.connect();
    this.logger.info('æ•°æ®åº“è¿æ¥æˆåŠŸ');
    client.release();

    // è¿è¡Œè¿ç§»ï¼ˆæ›¿ä»£createTablesï¼‰
    await this.runMigrations();
    this.logger.info('æ•°æ®åº“è¿ç§»å®Œæˆ');
  } catch (error) {
    this.logger.error('åˆå§‹åŒ–å¤±è´¥', error as Error);
    throw new StorageOperationError('initialize', (error as Error).message, {
      host: this.config.host,
      database: this.config.database,
    });
  }
}
```

#### 4.4 å®ç°è¿ç§»ç®¡ç†æ–¹æ³•

##### runMigrations() - è¿è¡Œæ‰€æœ‰å¾…åº”ç”¨çš„è¿ç§»
```typescript
private async runMigrations(): Promise<void> {
  // 1. ç¡®ä¿è¿ç§»å†å²è¡¨å­˜åœ¨
  await this.ensureMigrationsTable();

  // 2. è·å–å·²åº”ç”¨çš„è¿ç§»
  const appliedMigrations = await this.getAppliedMigrations();

  // 3. è·å–æ‰€æœ‰è¿ç§»æ–‡ä»¶
  const allFiles = this.getMigrationFiles();

  // 4. è¿‡æ»¤å¾…åº”ç”¨çš„è¿ç§»
  const pendingMigrations = allFiles.filter(f => !appliedMigrations.has(f));

  if (pendingMigrations.length === 0) {
    this.logger.info('æ²¡æœ‰å¾…åº”ç”¨çš„è¿ç§»');
    return;
  }

  this.logger.info(`å‘ç° ${pendingMigrations.length} ä¸ªå¾…åº”ç”¨çš„è¿ç§»`);

  // 5. åº”ç”¨æ¯ä¸ªå¾…åº”ç”¨çš„è¿ç§»
  for (const file of pendingMigrations) {
    await this.runMigration(file);
  }
}
```

##### ensureMigrationsTable() - ç¡®ä¿è¿ç§»å†å²è¡¨å­˜åœ¨
```typescript
private async ensureMigrationsTable(): Promise<void> {
  await this.pool.query(`
    CREATE TABLE IF NOT EXISTS ${this.migrationsTable} (
      id SERIAL PRIMARY KEY,
      name VARCHAR(255) NOT NULL UNIQUE,
      run_on TIMESTAMP NOT NULL DEFAULT NOW()
    )
  `);
}
```

##### getAppliedMigrations() - è·å–å·²åº”ç”¨çš„è¿ç§»
```typescript
private async getAppliedMigrations(): Promise<Set<string>> {
  const result = await this.pool.query(
    `SELECT name FROM ${this.migrationsTable} ORDER BY id`
  );
  return new Set(result.rows.map(row => row.name));
}
```

##### getMigrationFiles() - è·å–æ‰€æœ‰è¿ç§»æ–‡ä»¶
```typescript
private getMigrationFiles(): string[] {
  if (!fs.existsSync(this.migrationsDir)) {
    this.logger.warn(`è¿ç§»ç›®å½•ä¸å­˜åœ¨: ${this.migrationsDir}`);
    return [];
  }

  const files = fs.readdirSync(this.migrationsDir)
    .filter(f => f.endsWith('.sql'))
    .sort();
  return files;
}
```

##### runMigration() - è¿è¡Œå•ä¸ªè¿ç§»
```typescript
private async runMigration(filename: string): Promise<void> {
  const filePath = path.join(this.migrationsDir, filename);
  const sql = fs.readFileSync(filePath, 'utf-8');

  this.logger.info(`åº”ç”¨è¿ç§»: ${filename}`);

  const client = await this.pool.connect();
  try {
    await client.query('BEGIN');

    // æ‰§è¡Œè¿ç§»SQL
    await client.query(sql);

    // è®°å½•è¿ç§»å†å²
    await client.query(
      `INSERT INTO ${this.migrationsTable} (name) VALUES ($1)`,
      [filename]
    );

    await client.query('COMMIT');
    this.logger.info(`è¿ç§»æˆåŠŸ: ${filename}`);
  } catch (error) {
    await client.query('ROLLBACK');
    this.logger.error(`è¿ç§»å¤±è´¥: ${filename}`, error as Error);
    throw new StorageOperationError('migration', `Failed to apply ${filename}`, error);
  } finally {
    client.release();
  }
}
```

#### 4.5 åºŸå¼ƒæ—§çš„ createTables() æ–¹æ³•
```typescript
/**
 * åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆåºŸå¼ƒï¼Œä»…ç”¨äºå‘åå…¼å®¹ï¼‰
 * @deprecated ä½¿ç”¨ runMigrations() æ›¿ä»£
 */
private async createTables(): Promise<void> {
  // ... ä¿ç•™åŸæœ‰é€»è¾‘ï¼Œæ·»åŠ åºŸå¼ƒè­¦å‘Š
  this.logger.warn('âš ï¸  ä½¿ç”¨äº†åºŸå¼ƒçš„createTablesæ–¹æ³•ï¼Œè¯·ä½¿ç”¨è¿ç§»æ¡†æ¶');
}
```

---

## ğŸ“ˆ æ¶æ„æ”¹è¿›

### æ”¹è¿›å‰ï¼ˆæ—§æ–¹å¼ï¼‰

```typescript
async initialize(): Promise<void> {
  // æµ‹è¯•è¿æ¥
  const client = await this.pool.connect();
  client.release();

  // æ‰‹åŠ¨åˆ›å»ºè¡¨
  await this.createTables();  // âŒ é—®é¢˜ï¼š
                               // 1. æ— ç‰ˆæœ¬æ§åˆ¶
                               // 2. æ— å˜æ›´å†å²
                               // 3. æ— æ³•å›æ»š
                               // 4. å›¢é˜Ÿåä½œå›°éš¾
}
```

### æ”¹è¿›åï¼ˆæ–°æ–¹å¼ï¼‰

```typescript
async initialize(): Promise<void> {
  // æµ‹è¯•è¿æ¥
  const client = await this.pool.connect();
  client.release();

  // è¿è¡Œè¿ç§»æ¡†æ¶
  await this.runMigrations();  // âœ… ä¼˜åŠ¿ï¼š
                               // 1. Gitç‰ˆæœ¬æ§åˆ¶
                               // 2. è‡ªåŠ¨è®°å½•å†å²
                               // 3. å¯å›æ»šï¼ˆé€šè¿‡CLIï¼‰
                               // 4. å›¢é˜Ÿåä½œå‹å¥½
}
```

---

## ğŸ¯ å·¥ä½œæµç¨‹å¯¹æ¯”

### åœºæ™¯ï¼šæ·»åŠ æ–°å­—æ®µ `phone_number`

#### æ—§æ–¹å¼ï¼ˆ6æ­¥ï¼Œé«˜é£é™©ï¼‰
```
1. ä¿®æ”¹ createTables() SQL                     [æ‰‹åŠ¨ä¿®æ”¹ä»£ç ]
2. ä¿®æ”¹ TypeScript æ¥å£ UserRecordV2           [æ‰‹åŠ¨ä¿®æ”¹ä»£ç ]
3. ä¿®æ”¹ registerUser() æ–¹æ³•                    [æ‰‹åŠ¨ä¿®æ”¹ä»£ç ]
4. ä¿®æ”¹ mapUserRow() æ–¹æ³•                      [æ‰‹åŠ¨ä¿®æ”¹ä»£ç ]
5. ç”Ÿäº§æ•°æ®åº“æ‰‹åŠ¨æ‰§è¡Œ ALTER TABLE âš ï¸           [é«˜é£é™©æ“ä½œ]
6. æ›´æ–°æ–‡æ¡£                                    [å®¹æ˜“é—æ¼]
```

**é—®é¢˜**:
- âŒ äººå·¥å¤±è¯¯æ¦‚ç‡é«˜
- âŒ å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´
- âŒ æ— æ³•å›æ»š
- âŒ æ— å˜æ›´å†å²è®°å½•
- âŒ å›¢é˜Ÿåä½œå®¹æ˜“å†²çª

---

#### æ–°æ–¹å¼ï¼ˆ3æ­¥ï¼Œè‡ªåŠ¨åŒ–ï¼‰
```bash
# 1. åˆ›å»ºè¿ç§»æ–‡ä»¶
cat > src/multi-tenant/storage/migrations/002-add-phone-number.sql << EOF
-- Add phone_number field to users table
ALTER TABLE mcp_users ADD COLUMN phone_number VARCHAR(20);
CREATE INDEX idx_phone ON mcp_users(phone_number);
EOF

# 2. æ›´æ–° TypeScript æ¥å£
# (ä¿®æ”¹ UserRecordV2)

# 3. åº”ç”¨è¿ç§»ï¼ˆè‡ªåŠ¨åŒæ­¥æ‰€æœ‰ç¯å¢ƒï¼‰
# å¼€å‘ç¯å¢ƒ
POSTGRES_DB=extdebugdb npm run migrate:up

# æµ‹è¯•ç¯å¢ƒ
POSTGRES_DB=extdebugdb_test npm run migrate:up

# ç”Ÿäº§ç¯å¢ƒ
POSTGRES_DB=extdebugdb_prod npm run migrate:up
```

**ä¼˜åŠ¿**:
- âœ… Gitç‰ˆæœ¬æ§åˆ¶ï¼ˆå¯è¿½æº¯ï¼‰
- âœ… è‡ªåŠ¨åŒæ­¥ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
- âœ… å¯å›æ»š (`npm run migrate:down`)
- âœ… å›¢é˜Ÿåä½œå‹å¥½ï¼ˆé¿å…å†²çªï¼‰
- âœ… CI/CDé›†æˆï¼ˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### å¯åŠ¨æœåŠ¡å™¨ï¼ˆè‡ªåŠ¨åº”ç”¨è¿ç§»ï¼‰

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export POSTGRES_HOST=localhost
export POSTGRES_PORT=5432
export POSTGRES_DB=extdebugdb
export POSTGRES_USER=postgres
export POSTGRES_PASSWORD=your_password

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆä¼šè‡ªåŠ¨è¿è¡Œè¿ç§»ï¼‰
STORAGE_TYPE=postgresql npm run start:multi-tenant
```

**æ—¥å¿—è¾“å‡º**:
```
ğŸ’¾ Storage type: postgresql
   Using postgresql storage (will initialize async)
ğŸ”— è¿æ¥æ•°æ®åº“: {host: 'localhost', port: 5432, database: 'extdebugdb', user: 'postgres'}
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

[PostgreSQL] åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ {host: 'localhost', port: 5432, database: 'extdebugdb'}
[PostgreSQL] æ•°æ®åº“è¿æ¥æˆåŠŸ
[PostgreSQL] å‘ç° 1 ä¸ªå¾…åº”ç”¨çš„è¿ç§»
[PostgreSQL] åº”ç”¨è¿ç§»: 001-initial-schema.sql
[PostgreSQL] è¿ç§»æˆåŠŸ: 001-initial-schema.sql
[PostgreSQL] æ•°æ®åº“è¿ç§»å®Œæˆ
```

---

### æ‰‹åŠ¨ç®¡ç†è¿ç§»ï¼ˆCLIï¼‰

#### æŸ¥çœ‹è¿ç§»çŠ¶æ€
```bash
npm run migrate:status
```

**è¾“å‡º**:
```
ğŸ“Š è¿ç§»çŠ¶æ€:

| çŠ¶æ€ | è¿ç§»æ–‡ä»¶ |
|------|----------|
| âœ…   | 001-initial-schema.sql |

æ€»è®¡: 1 ä¸ªè¿ç§», 1 ä¸ªå·²åº”ç”¨
```

---

#### åº”ç”¨æ‰€æœ‰å¾…åº”ç”¨çš„è¿ç§»
```bash
npm run migrate:up
```

**è¾“å‡º**:
```
ğŸ”— è¿æ¥æ•°æ®åº“: {host: 'localhost', port: 5432, database: 'extdebugdb'}
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

ğŸ“¦ å‘ç° 0 ä¸ªå¾…åº”ç”¨çš„è¿ç§»
âœ… æ²¡æœ‰å¾…åº”ç”¨çš„è¿ç§»
```

---

#### å›æ»šæœ€å1ä¸ªè¿ç§»
```bash
npm run migrate:down
```

**è¾“å‡º**:
```
ğŸ“¦ å°†å›æ»š 1 ä¸ªè¿ç§»

â³ å›æ»šè¿ç§»: 001-initial-schema.sql
âœ… å›æ»šæˆåŠŸ: 001-initial-schema.sql

âœ… å›æ»šå®Œæˆ
```

---

### éªŒè¯è¡¨ç»“æ„

```bash
# è¿æ¥æ•°æ®åº“
psql -h localhost -U postgres -d extdebugdb

# æŸ¥çœ‹æ‰€æœ‰è¡¨
\dt

# æŸ¥çœ‹ç”¨æˆ·è¡¨ç»“æ„
\d mcp_users

# æŸ¥çœ‹æµè§ˆå™¨è¡¨ç»“æ„
\d mcp_browsers

# æŸ¥çœ‹è¿ç§»å†å²
SELECT * FROM pgmigrations ORDER BY run_on;
```

**è¿ç§»å†å²è¾“å‡º**:
```
 id |         name          |         run_on         
----+-----------------------+------------------------
  1 | 001-initial-schema.sql | 2025-10-14 20:00:00.123
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/multi-tenant/storage/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 001-initial-schema.sql    âœ… åˆå§‹Schema
â”‚   â””â”€â”€ README.md                  âœ… è¿ç§»æ–‡æ¡£
â”œâ”€â”€ PostgreSQLStorageAdapter.ts    âœ… é›†æˆè¿ç§»æ¡†æ¶
â””â”€â”€ StorageAdapter.ts

scripts/
â””â”€â”€ db-migrate.ts                  âœ… è¿ç§»ç®¡ç†CLI

package.json                       âœ… æ–°å¢npm scripts
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### ä¿®æ”¹ç»Ÿè®¡

| æ–‡ä»¶ | æ–°å¢è¡Œ | ä¿®æ”¹è¡Œ | åˆ é™¤è¡Œ | å‡€å¢é•¿ |
|------|--------|--------|--------|--------|
| PostgreSQLStorageAdapter.ts | +130 | +5 | -2 | +133 |
| 001-initial-schema.sql | +10 | 0 | 0 | +10 |
| db-migrate.ts | +1 | 0 | 0 | +1 |
| **æ€»è®¡** | **+141** | **+5** | **-2** | **+144** |

### åŠŸèƒ½ç»Ÿè®¡

| åŠŸèƒ½ | æ–¹æ³•æ•° | ä»£ç è¡Œæ•° |
|------|--------|---------|
| è¿ç§»ç®¡ç† | 5ä¸ª | ~100è¡Œ |
| è¿ç§»å†å² | 1ä¸ªè¡¨ | 3ä¸ªå­—æ®µ |
| è¿ç§»æ–‡ä»¶ | 1ä¸ª | 67è¡Œ |

---

## âœ… éªŒæ”¶æ ‡å‡†

### é˜¶æ®µ1å®Œæˆæ ‡å‡† âœ…

- [x] è¿ç§»ç›®å½•å·²åˆ›å»º âœ…
- [x] åˆå§‹è¿ç§»æ–‡ä»¶å·²åˆ›å»º âœ…
- [x] è¿ç§»ç®¡ç†è„šæœ¬å·²å®Œæˆ âœ…
- [x] npm scriptså·²æ·»åŠ  âœ…
- [x] ä¾èµ–å·²å®‰è£… âœ…
- [x] PostgreSQLStorageAdapterå·²ä¿®æ”¹ âœ…
- [x] è¿ç§»é€»è¾‘å·²é›†æˆ âœ…
- [x] é»˜è®¤æ•°æ®åº“å·²æ›´æ–°ä¸ºextdebugdb âœ…

### åŠŸèƒ½éªŒæ”¶ â³

- [ ] æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œè¿ç§»
- [ ] CLIæ‰‹åŠ¨ç®¡ç†è¿ç§»æ­£å¸¸å·¥ä½œ
- [ ] è¿ç§»å†å²æ­£ç¡®è®°å½•
- [ ] è¡¨ç»“æ„ç¬¦åˆé¢„æœŸ

---

## ğŸ‰ å…³é”®æˆæœ

### å·¥ç¨‹å®è·µæå‡

| æŒ‡æ ‡ | ä¿®æ”¹å‰ | ä¿®æ”¹å | æå‡ |
|------|--------|--------|------|
| Schemaç‰ˆæœ¬æ§åˆ¶ | âŒ æ‰‹åŠ¨ç®¡ç† | âœ… Git + è¿ç§»æ¡†æ¶ | +100% |
| ç¯å¢ƒä¸€è‡´æ€§ | âš ï¸ æ‰‹åŠ¨åŒæ­¥ | âœ… è‡ªåŠ¨åŒæ­¥ | +100% |
| å˜æ›´å¯è¿½æº¯æ€§ | âŒ æ— è®°å½• | âœ… è¿ç§»å†å²è¡¨ | +100% |
| å›æ»šèƒ½åŠ› | âŒ æ— æ³•å›æ»š | âœ… ä¸€é”®å›æ»š | +100% |
| å›¢é˜Ÿåä½œ | âš ï¸ å†²çªé¢‘ç¹ | âœ… Gitç®¡ç† | +80% |

---

## ğŸ“ åç»­ä»»åŠ¡

### é˜¶æ®µ0å‰©ä½™å·¥ä½œï¼ˆ15%ï¼‰

- [ ] åº”ç”¨é™æµå™¨åˆ°è¯·æ±‚å¤„ç†
- [ ] æ›´æ–°handlers-v2.tsåº”ç”¨é”™è¯¯ç±»
- [ ] å®Œæ•´æµ‹è¯•éªŒè¯

### é˜¶æ®µ2: Kyselyç±»å‹å®‰å…¨

- [ ] å®‰è£…Kysely
- [ ] å®šä¹‰Schemaç±»å‹
- [ ] åˆ›å»ºKyselyå®ä¾‹
- [ ] é‡æ„æŸ¥è¯¢
- [ ] ç±»å‹æµ‹è¯•

---

## ğŸ¯ æµ‹è¯•è®¡åˆ’

### æµ‹è¯•æ­¥éª¤

```bash
# 1. å‡†å¤‡æµ‹è¯•æ•°æ®åº“
createdb -U postgres extdebugdb_test

# 2. æµ‹è¯•è¿ç§»
export POSTGRES_DB=extdebugdb_test
npm run migrate:status
npm run migrate:up

# 3. éªŒè¯è¡¨ç»“æ„
psql -U postgres -d extdebugdb_test -c "\d mcp_users"
psql -U postgres -d extdebugdb_test -c "\d mcp_browsers"

# 4. æµ‹è¯•å›æ»š
npm run migrate:down
npm run migrate:up

# 5. å¯åŠ¨æœåŠ¡å™¨æµ‹è¯•
STORAGE_TYPE=postgresql POSTGRES_DB=extdebugdb_test npm run start:multi-tenant:dev
```

---

**çŠ¶æ€**: âœ… é˜¶æ®µ1å®Œæˆ  
**ä¸‹ä¸€æ­¥**: æµ‹è¯•éªŒè¯è¿ç§»æ¡†æ¶  
**é¢„è®¡å®Œæˆ**: ä»Šæ™šï¼ˆ10.14ï¼‰
