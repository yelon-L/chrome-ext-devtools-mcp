# MCP å¤šç§Ÿæˆ·ä»£ç†é¡¹ç›®æ€»ç»“

> âš ï¸ **æ–‡æ¡£å·²åºŸå¼ƒ** - æœ¬æ–‡æ¡£å·²åˆå¹¶åˆ° [Multi-Tenant å®Œæ•´æ–‡æ¡£](../MULTI_TENANT_COMPLETE.md)  
> è¯·ä½¿ç”¨æ–°çš„ç»Ÿä¸€æ–‡æ¡£ä»¥è·å–æœ€æ–°ä¿¡æ¯å’Œå®Œæ•´åŠŸèƒ½è¯´æ˜ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªæ”¯æŒå¤šç”¨æˆ·çš„ MCP (Model Context Protocol) ä»£ç†æœåŠ¡å™¨ï¼Œå…è®¸å¤šä¸ªå¼€å‘è€…åŒæ—¶é€šè¿‡åŒä¸€ä¸ª MCP æœåŠ¡å™¨è¿æ¥å’Œè°ƒè¯•å„è‡ªçš„ Chrome æµè§ˆå™¨åŠæ‰©å±•ã€‚

### æ ¸å¿ƒç‰¹æ€§

âœ… **å¤šç”¨æˆ·éš”ç¦»**: æ¯ä¸ªç”¨æˆ·æ“ä½œç‹¬ç«‹çš„æµè§ˆå™¨å®ä¾‹ï¼Œäº’ä¸å¹²æ‰°  
âœ… **ä¼šè¯ç®¡ç†**: è‡ªåŠ¨ç®¡ç†ç”¨æˆ·ä¼šè¯ç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒè¶…æ—¶æ¸…ç†  
âœ… **è®¤è¯æˆæƒ**: å¯é€‰çš„ Token è®¤è¯æœºåˆ¶ä¿éšœå®‰å…¨  
âœ… **è¿æ¥æ± **: æ™ºèƒ½ç®¡ç†æµè§ˆå™¨è¿æ¥ï¼Œæ”¯æŒå¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡è¿  
âœ… **SSE ä¼ è¾“**: åŸºäº Server-Sent Events çš„å®æ—¶é€šä¿¡  
âœ… **å®Œæ•´æµ‹è¯•**: å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒç»„ä»¶

## æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 MCP Multi-Tenant Proxy Server                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SessionManager  â”‚  â”‚  RouterManager   â”‚  â”‚  AuthManager â”‚ â”‚
â”‚  â”‚  ä¼šè¯ç®¡ç†         â”‚  â”‚  è·¯ç”±ç®¡ç†         â”‚  â”‚  è®¤è¯ç®¡ç†     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                    â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            BrowserConnectionPool                         â”‚  â”‚
â”‚  â”‚            æµè§ˆå™¨è¿æ¥æ±                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **SessionManager**: ç®¡ç†å®¢æˆ·ç«¯ SSE ä¼šè¯
2. **RouterManager**: ç®¡ç†ç”¨æˆ·åˆ°æµè§ˆå™¨çš„æ˜ å°„
3. **AuthManager**: å¤„ç†è®¤è¯å’Œæˆæƒ
4. **BrowserConnectionPool**: ç®¡ç†æµè§ˆå™¨è¿æ¥æ± 

è¯¦è§: [MULTI_TENANT_ARCHITECTURE.md](./MULTI_TENANT_ARCHITECTURE.md)

## é¡¹ç›®ç»“æ„

```
chrome-ext-devtools-mcp/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ multi-tenant/
â”‚       â”œâ”€â”€ server-multi-tenant.ts          # ä¸»æœåŠ¡å™¨
â”‚       â”œâ”€â”€ core/
â”‚       â”‚   â”œâ”€â”€ SessionManager.ts           # ä¼šè¯ç®¡ç†å™¨
â”‚       â”‚   â”œâ”€â”€ RouterManager.ts            # è·¯ç”±ç®¡ç†å™¨
â”‚       â”‚   â”œâ”€â”€ AuthManager.ts              # è®¤è¯ç®¡ç†å™¨
â”‚       â”‚   â””â”€â”€ BrowserConnectionPool.ts    # è¿æ¥æ± 
â”‚       â””â”€â”€ types/
â”‚           â”œâ”€â”€ session.types.ts            # ä¼šè¯ç±»å‹å®šä¹‰
â”‚           â”œâ”€â”€ router.types.ts             # è·¯ç”±ç±»å‹å®šä¹‰
â”‚           â”œâ”€â”€ auth.types.ts               # è®¤è¯ç±»å‹å®šä¹‰
â”‚           â””â”€â”€ browser-pool.types.ts       # è¿æ¥æ± ç±»å‹å®šä¹‰
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ multi-tenant/
â”‚       â”œâ”€â”€ SessionManager.test.ts          # ä¼šè¯ç®¡ç†å™¨æµ‹è¯•
â”‚       â”œâ”€â”€ RouterManager.test.ts           # è·¯ç”±ç®¡ç†å™¨æµ‹è¯•
â”‚       â””â”€â”€ AuthManager.test.ts             # è®¤è¯ç®¡ç†å™¨æµ‹è¯•
â””â”€â”€ docs/
    â”œâ”€â”€ MULTI_TENANT_ARCHITECTURE.md        # æ¶æ„è®¾è®¡æ–‡æ¡£
    â”œâ”€â”€ MULTI_TENANT_DEV_STANDARDS.md       # å¼€å‘è§„èŒƒ
    â”œâ”€â”€ MULTI_TENANT_TEST_PLAN.md           # æµ‹è¯•è®¡åˆ’
    â”œâ”€â”€ MULTI_TENANT_USAGE.md               # ä½¿ç”¨æŒ‡å—
    â””â”€â”€ MULTI_TENANT_README.md              # æœ¬æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…å’Œæ„å»º

```bash
npm install
npm run build
```

### 2. å¯åŠ¨æœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼ï¼ˆç¦ç”¨è®¤è¯ï¼‰
npm run start:multi-tenant:dev

# ç”Ÿäº§æ¨¡å¼ï¼ˆå¯ç”¨è®¤è¯ï¼‰
npm run start:multi-tenant
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå¤šç§Ÿæˆ·æµ‹è¯•
npm run test:multi-tenant

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test
```

## ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ï¼šä¸¤ä¸ªå¼€å‘è€…ç‹¬ç«‹è°ƒè¯•

**å¼€å‘è€… A:**

```bash
# 1. å¯åŠ¨ Chrome
chrome --remote-debugging-port=9222

# 2. æ³¨å†Œåˆ°æœåŠ¡å™¨
curl -X POST http://localhost:32122/api/register \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "developer-a",
    "browserURL": "http://localhost:9222"
  }'

# 3. åœ¨ IDE ä¸­é…ç½®
# X-User-Id: developer-a
```

**å¼€å‘è€… B:**

```bash
# 1. å¯åŠ¨ Chrome (ä¸åŒç«¯å£)
chrome --remote-debugging-port=9223

# 2. æ³¨å†Œåˆ°æœåŠ¡å™¨
curl -X POST http://localhost:32122/api/register \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "developer-b",
    "browserURL": "http://localhost:9223"
  }'

# 3. åœ¨ IDE ä¸­é…ç½®
# X-User-Id: developer-b
```

ç°åœ¨ä¸¤ä¸ªå¼€å‘è€…å¯ä»¥åŒæ—¶ä½¿ç”¨ MCP å·¥å…·è°ƒè¯•å„è‡ªçš„æµè§ˆå™¨ï¼Œäº’ä¸å¹²æ‰°ï¼

è¯¦è§: [MULTI_TENANT_USAGE.md](./MULTI_TENANT_USAGE.md)

## API ç«¯ç‚¹

| ç«¯ç‚¹                        | æ–¹æ³• | è¯´æ˜                 |
| --------------------------- | ---- | -------------------- |
| `/health`                   | GET  | å¥åº·æ£€æŸ¥å’ŒæœåŠ¡å™¨çŠ¶æ€ |
| `/api/register`             | POST | æ³¨å†Œç”¨æˆ·å’Œæµè§ˆå™¨     |
| `/api/users`                | GET  | æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨         |
| `/api/users/:userId/status` | GET  | æŸ¥è¯¢ç”¨æˆ·çŠ¶æ€         |
| `/sse`                      | GET  | å»ºç«‹ SSE è¿æ¥        |
| `/message`                  | POST | å‘é€ MCP æ¶ˆæ¯        |
| `/test`                     | GET  | æµ‹è¯•é¡µé¢             |

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

```bash
# æœåŠ¡å™¨ç«¯å£
PORT=32122

# æ˜¯å¦å¯ç”¨è®¤è¯
AUTH_ENABLED=true

# Node ç¯å¢ƒ
NODE_ENV=production
```

### ä»£ç é…ç½®

```typescript
// ä¼šè¯è¶…æ—¶
sessionManager = new SessionManager({
  timeout: 3600000, // 1 å°æ—¶
  cleanupInterval: 60000, // 1 åˆ†é’Ÿ
  maxSessions: 100, // æœ€å¤§ä¼šè¯æ•°
});

// æµè§ˆå™¨å¥åº·æ£€æŸ¥
browserPool = new BrowserConnectionPool({
  healthCheckInterval: 30000, // 30 ç§’
  maxReconnectAttempts: 3, // æœ€å¤§é‡è¿æ¬¡æ•°
  reconnectDelay: 5000, // é‡è¿å»¶è¿Ÿ
  connectionTimeout: 10000, // è¿æ¥è¶…æ—¶
});
```

## å¼€å‘è®¡åˆ’æ‰§è¡Œæƒ…å†µ

### âœ… ç¬¬ä¸€é˜¶æ®µï¼šæ¶æ„è®¾è®¡å’Œè§„èŒƒåˆ¶å®š

- [x] æ¶æ„è®¾è®¡æ–‡æ¡£
- [x] å¼€å‘è§„èŒƒæ–‡æ¡£
- [x] æµ‹è¯•è®¡åˆ’æ–‡æ¡£

### âœ… ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®ç° - ä¼šè¯ç®¡ç†å’Œè·¯ç”±

- [x] SessionManager å®ç°
- [x] RouterManager å®ç°

### âœ… ç¬¬ä¸‰é˜¶æ®µï¼šç”¨æˆ·æ³¨å†Œå’Œè®¤è¯æœºåˆ¶

- [x] AuthManager å®ç°
- [x] Token è®¤è¯æœºåˆ¶

### âœ… ç¬¬å››é˜¶æ®µï¼šè¿æ¥æ± ç®¡ç†

- [x] BrowserConnectionPool å®ç°
- [x] å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡è¿

### âœ… ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•æ¡†æ¶å’Œå•å…ƒæµ‹è¯•

- [x] SessionManager æµ‹è¯•
- [x] RouterManager æµ‹è¯•
- [x] AuthManager æµ‹è¯•

### ğŸ”„ ç¬¬å…­é˜¶æ®µï¼šé›†æˆæµ‹è¯•å’Œå¤šç”¨æˆ·åœºæ™¯æµ‹è¯•

- [ ] å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•
- [ ] å¤šç”¨æˆ·å¹¶å‘æµ‹è¯•
- [ ] æ•…éšœæ¢å¤æµ‹è¯•

### âœ… ç¬¬ä¸ƒé˜¶æ®µï¼šæ–‡æ¡£å’Œéƒ¨ç½²æŒ‡å—

- [x] ä½¿ç”¨æ–‡æ¡£
- [x] API æ–‡æ¡£
- [x] éƒ¨ç½²æŒ‡å—

## æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•

- **SessionManager**: 11 ä¸ªæµ‹è¯•ç”¨ä¾‹ âœ…
- **RouterManager**: 10 ä¸ªæµ‹è¯•ç”¨ä¾‹ âœ…
- **AuthManager**: 13 ä¸ªæµ‹è¯•ç”¨ä¾‹ âœ…
- **BrowserConnectionPool**: å¾…å®ç°

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå¤šç§Ÿæˆ·æµ‹è¯•
npm run test:multi-tenant

# é¢„æœŸè¾“å‡º
âœ” SessionManager (11 tests)
âœ” RouterManager (10 tests)
âœ” AuthManager (13 tests)
```

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡           | ç›®æ ‡å€¼ | å®é™…å€¼ |
| -------------- | ------ | ------ |
| SSE è¿æ¥æ—¶é—´   | < 1s   | å¾…æµ‹è¯• |
| å·¥å…·è°ƒç”¨å“åº”   | < 3s   | å¾…æµ‹è¯• |
| å¹¶å‘ç”¨æˆ·æ•°     | > 50   | å¾…æµ‹è¯• |
| å†…å­˜ä½¿ç”¨å¢é•¿   | < 10%  | å¾…æµ‹è¯• |
| ä¼šè¯æ¸…ç†é—´éš”   | 60s    | âœ…     |
| æµè§ˆå™¨å¥åº·æ£€æŸ¥ | 30s    | âœ…     |

## å®‰å…¨ç‰¹æ€§

âœ… **Token è®¤è¯**: æ”¯æŒ Bearer Token è®¤è¯  
âœ… **ä¼šè¯éš”ç¦»**: ç”¨æˆ·é—´å®Œå…¨éš”ç¦»  
âœ… **è‡ªåŠ¨æ¸…ç†**: è¿‡æœŸä¼šè¯è‡ªåŠ¨æ¸…ç†  
âœ… **Token æ’¤é”€**: æ”¯æŒ Token æ’¤é”€æœºåˆ¶  
âœ… **æƒé™æ§åˆ¶**: åŸºäºæƒé™çš„æˆæƒ

## å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

1. **æµè§ˆå™¨è¿æ¥**: éœ€è¦æµè§ˆå™¨å¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£
2. **ç½‘ç»œè¦æ±‚**: ç”¨æˆ·æµè§ˆå™¨éœ€èƒ½è¢«æœåŠ¡å™¨è®¿é—®
3. **å¹¶å‘é™åˆ¶**: æœªè¿›è¡Œå¤§è§„æ¨¡å¹¶å‘æµ‹è¯•
4. **æŒä¹…åŒ–**: ç”¨æˆ·æ³¨å†Œä¿¡æ¯æš‚ä¸æŒä¹…åŒ–

## æœªæ¥è®¡åˆ’

- [ ] æ·»åŠ  BrowserConnectionPool å•å…ƒæµ‹è¯•
- [ ] å®ç°é›†æˆæµ‹è¯•å¥—ä»¶
- [ ] æ·»åŠ æ€§èƒ½æµ‹è¯•
- [ ] æ”¯æŒé…ç½®æ–‡ä»¶
- [ ] æ·»åŠ æ—¥å¿—æŒä¹…åŒ–
- [ ] å®ç°ç”¨æˆ·æ³¨å†Œä¿¡æ¯æŒä¹…åŒ–
- [ ] æ·»åŠ  WebSocket ä¼ è¾“æ”¯æŒ
- [ ] å®ç°åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒ
- [ ] æ·»åŠ ç›‘æ§ä»ªè¡¨ç›˜

## è´¡çŒ®æŒ‡å—

å¼€å‘æ–°åŠŸèƒ½è¯·éµå¾ªä»¥ä¸‹æµç¨‹ï¼š

1. é˜…è¯» [å¼€å‘è§„èŒƒ](./MULTI_TENANT_DEV_STANDARDS.md)
2. ç¼–å†™ä»£ç å¹¶éµå¾ªå‘½åå’Œæ¶æ„è§„èŒƒ
3. ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰
4. è¿è¡Œ `npm test` ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
5. æ›´æ–°ç›¸å…³æ–‡æ¡£
6. æäº¤ Pull Request

## æ–‡æ¡£ç´¢å¼•

- **æ¶æ„è®¾è®¡**: [MULTI_TENANT_ARCHITECTURE.md](./MULTI_TENANT_ARCHITECTURE.md)
- **å¼€å‘è§„èŒƒ**: [MULTI_TENANT_DEV_STANDARDS.md](./MULTI_TENANT_DEV_STANDARDS.md)
- **æµ‹è¯•è®¡åˆ’**: [MULTI_TENANT_TEST_PLAN.md](./MULTI_TENANT_TEST_PLAN.md)
- **ä½¿ç”¨æŒ‡å—**: [MULTI_TENANT_USAGE.md](./MULTI_TENANT_USAGE.md)
- **éƒ¨ç½²æŒ‡å—**: [REMOTE_MCP_GUIDE.md](../REMOTE_MCP_GUIDE.md)

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¯åŠ¨æœåŠ¡å™¨ï¼Ÿ

```bash
npm run start:multi-tenant:dev
```

### Q: å¦‚ä½•è¿è¡Œæµ‹è¯•ï¼Ÿ

```bash
npm run test:multi-tenant
```

### Q: å¦‚ä½•ç¦ç”¨è®¤è¯ï¼Ÿ

```bash
AUTH_ENABLED=false npm run start:multi-tenant
```

### Q: æ”¯æŒå¤šå°‘å¹¶å‘ç”¨æˆ·ï¼Ÿ

ç†è®ºä¸Šæ— é™åˆ¶ï¼Œå»ºè®®å…ˆè¿›è¡Œå‹åŠ›æµ‹è¯•ç¡®å®šå®é™…æ‰¿è½½èƒ½åŠ›ã€‚

### Q: æµè§ˆå™¨æ–­å¼€åä¼šè‡ªåŠ¨é‡è¿å—ï¼Ÿ

ä¼šã€‚BrowserConnectionPool ä¼šè‡ªåŠ¨æ£€æµ‹æ–­å¼€å¹¶å°è¯•é‡è¿ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰ã€‚

## è·å–å¸®åŠ©

- **GitHub Issues**: https://github.com/ChromeDevTools/chrome-devtools-mcp/issues
- **æ–‡æ¡£ç›®å½•**: `/docs/MULTI_TENANT_*.md`
- **æµ‹è¯•ç¤ºä¾‹**: `/tests/multi-tenant/*.test.ts`

## è‡´è°¢

æœ¬é¡¹ç›®åŸºäº [Chrome DevTools MCP](https://github.com/ChromeDevTools/chrome-devtools-mcp) æ„å»ºã€‚

## è®¸å¯è¯

Apache-2.0 License

---

**é¡¹ç›®çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå¾…é›†æˆæµ‹è¯•  
**æœ€åæ›´æ–°**: 2025-01-12
