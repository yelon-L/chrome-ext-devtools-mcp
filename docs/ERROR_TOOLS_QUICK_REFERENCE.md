# æ‰©å±•é”™è¯¯å·¥å…· - å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå†³ç­–

```
éœ€è¦è¯Šæ–­å·²çŸ¥é”™è¯¯ï¼Ÿ
  â””â”€ ä½¿ç”¨ diagnose_extension_errors

éœ€è¦æ•è·éš¾ä»¥å¤ç°çš„é”™è¯¯ï¼Ÿ
  â””â”€ å…ˆ enhance_extension_error_capture
     å† diagnose_extension_errors

éœ€è¦ç”Ÿäº§ç›‘æ§ï¼Ÿ
  â””â”€ é¦–æ¬¡ enhance_extension_error_capture
     å®šæœŸ diagnose_extension_errors
```

---

## ğŸ“‹ å·¥å…·é€ŸæŸ¥

### diagnose_extension_errorsï¼ˆè¯Šæ–­å·¥å…·ï¼‰

**ç”¨é€”**ï¼šåˆ†æå’Œè¯Šæ–­æ‰©å±•é”™è¯¯

**å‚æ•°**ï¼š

```json
{
  "extensionId": "abcd...",
  "timeRange": 60, // å¯é€‰ï¼Œé»˜è®¤10åˆ†é’Ÿ
  "includeWarnings": true // å¯é€‰ï¼Œé»˜è®¤false
}
```

**è¾“å‡º**ï¼š

- âœ… é”™è¯¯æ€»ç»“
- âœ… é”™è¯¯åˆ†ç±»
- âœ… é¢‘ç‡ç»Ÿè®¡
- âœ… è¯¦ç»†æ—¥å¿—
- âœ… è¯Šæ–­å»ºè®®
- âœ… å¥åº·è¯„åˆ†

**ç‰¹ç‚¹**ï¼š

- âœ… åªè¯»ï¼Œæ— å‰¯ä½œç”¨
- âœ… éšæ—¶å¯ç”¨
- âœ… å¿«é€Ÿå“åº”

---

### enhance_extension_error_captureï¼ˆå¢å¼ºå·¥å…·ï¼‰

**ç”¨é€”**ï¼šæ³¨å…¥é”™è¯¯ç›‘å¬å™¨ï¼Œæ•è·æ›´å¤šé”™è¯¯

**å‚æ•°**ï¼š

```json
{
  "extensionId": "abcd...",
  "captureStackTraces": true // å¯é€‰ï¼Œé»˜è®¤true
}
```

**è¾“å‡º**ï¼š

- âœ… æ³¨å…¥çŠ¶æ€
- âœ… æ•è·èƒ½åŠ›è¯´æ˜
- âœ… ç”Ÿå‘½å‘¨æœŸæç¤º

**æ•è·å†…å®¹**ï¼š

- âŒ æœªæ•è·çš„JavaScripté”™è¯¯
- ğŸ”´ æœªå¤„ç†çš„Promiseæ‹’ç»
- ğŸ“ æ–‡ä»¶ä½ç½®å’Œè¡Œå·
- ğŸ“š å®Œæ•´å †æ ˆè·Ÿè¸ª

**ç‰¹ç‚¹**ï¼š

- âš ï¸ ä¾µå…¥å¼ï¼ˆæ³¨å…¥ä»£ç ï¼‰
- âš ï¸ éœ€è¦Service Workeræ¿€æ´»
- âœ… æŒç»­ç”Ÿæ•ˆç›´åˆ°æ‰©å±•é‡è½½

---

## ğŸ”„ å¸¸ç”¨å·¥ä½œæµ

### åœºæ™¯1ï¼šå¿«é€Ÿè¯Šæ–­

```bash
# ä¸€é”®è¯Šæ–­
diagnose_extension_errors({
  "extensionId": "xxx",
  "timeRange": 60
})
```

### åœºæ™¯2ï¼šæ·±åº¦è°ƒè¯•

```bash
# 1. æ¿€æ´»Service Workerï¼ˆMV3æ‰©å±•ï¼‰
activate_extension_service_worker({"extensionId": "xxx"})

# 2. å¢å¼ºé”™è¯¯æ•è·
enhance_extension_error_capture({
  "extensionId": "xxx",
  "captureStackTraces": true
})

# 3. è§¦å‘æ‰©å±•åŠŸèƒ½
# (æ‰‹åŠ¨æ“ä½œæˆ–è‡ªåŠ¨åŒ–æµ‹è¯•)

# 4. è¯Šæ–­åˆ†æ
diagnose_extension_errors({
  "extensionId": "xxx",
  "timeRange": 5
})
```

### åœºæ™¯3ï¼šå¼€å‘è°ƒè¯•å¾ªç¯

```bash
# 1. é¦–æ¬¡å¢å¼º
enhance_extension_error_capture({"extensionId": "xxx"})

# 2. ä¿®æ”¹ä»£ç åé‡è½½
reload_extension({
  "extensionId": "xxx",
  "captureErrors": true
})

# 3. é‡æ–°å¢å¼ºï¼ˆreloadä¼šæ¸…é™¤ï¼‰
enhance_extension_error_capture({"extensionId": "xxx"})

# 4. æµ‹è¯•åŠŸèƒ½
# ...

# 5. è¯Šæ–­
diagnose_extension_errors({"extensionId": "xxx"})

# é‡å¤æ­¥éª¤2-5
```

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### è¯Šæ–­å·¥å…·æŠ€å·§

1. **è°ƒæ•´æ—¶é—´èŒƒå›´**

   ```bash
   # æŸ¥çœ‹æœ€è¿‘5åˆ†é’Ÿ
   {"timeRange": 5}

   # æŸ¥çœ‹æœ€è¿‘1å°æ—¶
   {"timeRange": 60}

   # æŸ¥çœ‹24å°æ—¶
   {"timeRange": 1440}
   ```

2. **åŒ…å«è­¦å‘Š**

   ```bash
   # ä»…çœ‹é”™è¯¯ï¼ˆé»˜è®¤ï¼‰
   {"includeWarnings": false}

   # åŒæ—¶çœ‹é”™è¯¯å’Œè­¦å‘Š
   {"includeWarnings": true}
   ```

3. **å…³æ³¨å¥åº·è¯„åˆ†**
   ```
   90-100: ä¼˜ç§€
   70-89:  è‰¯å¥½
   50-69:  éœ€è¦å…³æ³¨
   <50:    ä¸¥é‡é—®é¢˜
   ```

### å¢å¼ºå·¥å…·æŠ€å·§

1. **æ£€æŸ¥æ˜¯å¦å·²å¢å¼º**

   ```bash
   # é‡å¤è°ƒç”¨æ˜¯å®‰å…¨çš„
   enhance_extension_error_capture({"extensionId": "xxx"})
   # è¾“å‡ºï¼šAlready Enhancedï¼ˆå¦‚æœå·²æ³¨å…¥ï¼‰
   ```

2. **æ‰©å±•é‡è½½åéœ€è¦é‡æ–°å¢å¼º**

   ```bash
   reload_extension(...)
   # âš ï¸ å¢å¼ºç›‘å¬å™¨å·²ä¸¢å¤±
   enhance_extension_error_capture(...)
   # âœ… é‡æ–°æ³¨å…¥
   ```

3. **Service Workeré‡å¯åéœ€è¦é‡æ–°å¢å¼º**
   ```bash
   # MV3æ‰©å±•çš„Service Workerå¯èƒ½è‡ªåŠ¨ä¼‘çœ 
   # ä¼‘çœ åç›‘å¬å™¨ä¼šä¸¢å¤±
   # éœ€è¦é‡æ–°å¢å¼º
   ```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¯Šæ–­æ²¡æœ‰å‘ç°é”™è¯¯ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š

1. æ‰©å±•ç¡®å®æ²¡æœ‰é”™è¯¯ âœ…
2. é”™è¯¯æ²¡æœ‰è¢«console.logè®°å½• âš ï¸
3. é”™è¯¯æ˜¯Promiseæ‹’ç»ï¼ˆæœªå¤„ç†ï¼‰ âš ï¸

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
enhance_extension_error_capture({"extensionId": "xxx"})
# ç„¶åé‡æ–°è§¦å‘æ“ä½œ
```

### Q2: å¢å¼ºå·¥å…·æŠ¥é”™"Service Worker is inactive"

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# å…ˆæ¿€æ´»Service Worker
activate_extension_service_worker({"extensionId": "xxx"})

# å†å¢å¼º
enhance_extension_error_capture({"extensionId": "xxx"})
```

### Q3: å¢å¼ºåè¿˜æ˜¯æ²¡æœ‰æ•è·åˆ°é”™è¯¯

**å¯èƒ½åŸå› **ï¼š

1. é”™è¯¯å‘ç”Ÿåœ¨å¢å¼ºä¹‹å‰
2. é”™è¯¯å‘ç”Ÿåœ¨content scriptä¸­ï¼ˆéœ€è¦å•ç‹¬å¢å¼ºï¼‰
3. é”™è¯¯è¢«try-catchæ•è·äº†

**å»ºè®®**ï¼š

- å¢å¼ºåé‡æ–°è§¦å‘æ“ä½œ
- æ£€æŸ¥content scriptæ—¥å¿—
- ä½¿ç”¨debuggeræ–­ç‚¹è°ƒè¯•

### Q4: éœ€è¦æ¸…é™¤å¢å¼ºçš„ç›‘å¬å™¨å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼šä¸éœ€è¦

- ç›‘å¬å™¨ä¼šåœ¨æ‰©å±•é‡è½½æ—¶è‡ªåŠ¨æ¸…é™¤
- ç›‘å¬å™¨å¯¹æ€§èƒ½å½±å“æå°
- é‡å¤æ³¨å…¥æ˜¯å®‰å…¨çš„ï¼ˆå¹‚ç­‰ï¼‰

---

## ğŸ“Š å·¥å…·é€‰æ‹©çŸ©é˜µ

| éœ€æ±‚            | æ¨èå·¥å…·                          | åŸå›            |
| --------------- | --------------------------------- | -------------- |
| æŸ¥çœ‹ç°æœ‰é”™è¯¯    | diagnose                          | å¿«é€Ÿã€æ— ä¾µå…¥   |
| æ•è·Promiseé”™è¯¯ | enhance + diagnose                | éœ€è¦æ³¨å…¥ç›‘å¬å™¨ |
| å®šæœŸå¥åº·æ£€æŸ¥    | diagnose                          | åªéœ€è¦åˆ†æ     |
| å¼€å‘è°ƒè¯•        | enhance + diagnose                | éœ€è¦å…¨é¢æ•è·   |
| ç”Ÿäº§ç›‘æ§        | enhanceï¼ˆä¸€æ¬¡ï¼‰+ diagnoseï¼ˆå®šæœŸï¼‰ | æŒç»­ç›‘æ§       |
| CI/CDæ£€æŸ¥       | enhance + diagnose                | è‡ªåŠ¨åŒ–æµ‹è¯•     |

---

## ğŸ”— ç›¸å…³å·¥å…·

| å·¥å…·                                | ç”¨é€”                     |
| ----------------------------------- | ------------------------ |
| `list_extensions`                   | è·å–æ‰©å±•ID               |
| `activate_extension_service_worker` | æ¿€æ´»SWï¼ˆå¢å¼ºçš„å‰ç½®æ¡ä»¶ï¼‰ |
| `get_extension_logs`                | æŸ¥çœ‹åŸå§‹æ—¥å¿—             |
| `reload_extension`                  | é‡è½½æ‰©å±•                 |

---

## ğŸ“š å®Œæ•´æ–‡æ¡£

- **å·¥å…·å…³ç³»è¯¦è§£**: `EXTENSION_ERROR_TOOLS_RELATIONSHIP.md`
- **é”™è¯¯è®¿é—®è®¾è®¡**: `EXTENSION_ERRORS_ACCESS_DESIGN.md`

---

**å¿«é€Ÿè®°å¿†å£è¯€**ï¼š

```
çœ‹å·²æœ‰é”™è¯¯ â†’ diagnose
æŠ“æœªçŸ¥é”™è¯¯ â†’ enhance + diagnose
å¼€å‘è°ƒè¯• â†’ enhanceä¸€æ¬¡ + å¤šæ¬¡diagnose
ç”Ÿäº§ç›‘æ§ â†’ enhanceä¿æŒ + å®šæœŸdiagnose
```
