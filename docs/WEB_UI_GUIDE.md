# Web UI 使用指南

## 概览

Chrome DevTools MCP 提供了一个简约美观的 Web 管理界面，用于管理用户和浏览器。

---

## 访问方式

### 启动服务器

```bash
# 开发模式（无认证）
npm run start:multi-tenant:dev

# 生产模式（启用认证）
npm run start:multi-tenant
```

### 访问 Web UI

打开浏览器访问：
```
http://localhost:32122/
```

---

## 功能介绍

### 1. 用户管理 👥

查看和管理所有注册用户。

**功能**:
- ✅ 查看用户列表
- ✅ 查看用户的浏览器数量
- ✅ 查看注册时间
- ✅ 删除用户（级联删除所有浏览器）
- ✅ 实时刷新用户数据

**操作**:
- **查看浏览器**: 点击"🌐 浏览器"按钮查看用户的所有浏览器
- **删除用户**: 点击"🗑️ 删除"按钮（会删除用户及其所有浏览器）
- **刷新**: 点击"🔄 刷新"按钮更新数据

---

### 2. 注册用户 ➕

注册新用户并绑定浏览器。

**必填字段**:
- **📧 邮箱地址**: 用户的唯一标识（如：`user@example.com`）
- **🌐 浏览器地址**: Chrome 调试地址（默认：`http://localhost:9222`）

**可选字段**:
- **👤 用户名**: 显示名称（默认使用邮箱前缀）
- **🏷️ 浏览器名称**: 浏览器实例名称（如：`dev-chrome`）

**注册流程**:
1. 填写用户信息
2. 确保浏览器已启动：`chrome --remote-debugging-port=9222`
3. 点击"✅ 注册并绑定浏览器"
4. 保存显示的 Token（用于 SSE V2 连接）

**注意事项**:
- ⚠️ Token 只显示一次，请务必保存
- ⚠️ 浏览器必须可访问，否则注册失败
- ⚠️ 邮箱不能重复

---

### 3. 浏览器管理 🌐

管理用户绑定的浏览器实例。

**查看方式**:
1. 在用户列表中点击"🌐 浏览器"
2. 弹出浏览器列表模态框

**显示信息**:
- 浏览器名称
- 浏览器 URL
- Token（部分显示）
- 创建时间

**操作**:
- **解绑浏览器**: 点击"🗑️ 解绑"按钮撤销浏览器（Token 同时失效）

---

### 4. 关于 ℹ️

查看 V2 API 的核心特性和端点信息。

**核心特性**:
- 📧 基于邮箱的用户注册
- 🌐 每个用户可绑定多个浏览器
- 🔑 每个浏览器独立 token
- ⚡ Token 自动识别浏览器
- 🔐 安全的 SSE V2 连接

**API 端点**:
```
POST   /api/users                      - 注册用户
GET    /api/users                      - 列出所有用户
POST   /api/users/:id/browsers         - 绑定浏览器
GET    /api/users/:id/browsers         - 列出浏览器
GET    /sse-v2                         - SSE V2 连接
```

---

## 界面预览

### 用户列表

```
┌─────────────────────────────────────────────┐
│ 👥 用户列表                           [0]   │
│                                       🔄 刷新 │
├─────────────────────────────────────────────┤
│ 用户ID    │ 邮箱         │ 浏览器 │ 操作  │
│ test-123  │ test@ex.com  │ 1 个   │ 🌐🗑️ │
│ alice     │ alice@ex.com │ 2 个   │ 🌐🗑️ │
└─────────────────────────────────────────────┘
```

### 注册表单

```
┌─────────────────────────────────────────────┐
│ ➕ 注册用户                                 │
├─────────────────────────────────────────────┤
│ 📧 邮箱地址 *                               │
│ [user@example.com                  ]        │
│                                             │
│ 👤 用户名                                   │
│ [User                              ]        │
│                                             │
│ 🌐 浏览器地址 *                             │
│ [http://localhost:9222             ]        │
│ 💡 chrome --remote-debugging-port=9222      │
│                                             │
│ 🏷️ 浏览器名称                              │
│ [dev-chrome                        ]        │
│                                             │
│          [✅ 注册并绑定浏览器]              │
└─────────────────────────────────────────────┘
```

### Token 显示

```
┌─────────────────────────────────────────────┐
│ 🎉 注册成功！                               │
├─────────────────────────────────────────────┤
│ ✅ 用户已注册并成功绑定浏览器               │
│                                             │
│ 用户 ID:                                    │
│ ┌─────────────────────────────────────────┐ │
│ │ test-1234567890                         │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ 访问 Token（请妥善保存）:                  │
│ ┌─────────────────────────────────────────┐ │
│ │ mcp_abc123...                           │ │
│ └─────────────────────────────────────────┘ │
│ [📋 复制 Token]                             │
│                                             │
│ 浏览器名称:                                 │
│ ┌─────────────────────────────────────────┐ │
│ │ dev-chrome                              │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│                          [✅ 我已保存]      │
└─────────────────────────────────────────────┘
```

---

## 设计特点

### 🎨 视觉设计

- **渐变背景**: 紫色渐变（#667eea → #764ba2）
- **卡片式布局**: 圆角、阴影、白色背景
- **响应式设计**: 适配桌面和移动设备
- **现代图标**: Emoji 图标，直观易懂

### ⚡ 用户体验

- **即时反馈**: 操作后立即显示提示消息
- **确认对话**: 删除操作前需要确认
- **加载状态**: 按钮显示加载动画
- **错误提示**: 友好的错误消息

### 🔐 安全性

- **路径验证**: 防止目录遍历攻击
- **CORS 支持**: 可配置跨域白名单
- **Token 保护**: Token 只显示一次
- **输入验证**: 邮箱格式验证

---

## 技术栈

- **纯 HTML/CSS/JavaScript**: 无外部依赖
- **原生 Fetch API**: RESTful API 调用
- **响应式设计**: Flexbox + Media Queries
- **模态框**: 原生实现，无需库

---

## 浏览器兼容性

| 浏览器 | 最低版本 | 状态 |
|--------|----------|------|
| Chrome | 90+ | ✅ 完全支持 |
| Edge | 90+ | ✅ 完全支持 |
| Firefox | 88+ | ✅ 完全支持 |
| Safari | 14+ | ✅ 完全支持 |

---

## 自定义配置

### 环境变量

```bash
# 端口
PORT=32122

# CORS 白名单
ALLOWED_ORIGINS=http://localhost:3000,https://example.com

# IP 白名单
ALLOWED_IPS=127.0.0.1,192.168.1.0/24
```

### 自定义样式

编辑 `src/multi-tenant/public/index.html` 中的 `<style>` 部分。

---

## 常见问题

### Q: 无法访问 Web UI

**A**: 检查服务器是否启动：
```bash
curl http://localhost:32122/health
```

### Q: 注册失败："浏览器不可访问"

**A**: 确保 Chrome 以调试模式运行：
```bash
google-chrome --remote-debugging-port=9222 --remote-debugging-address=0.0.0.0
```

### Q: Token 丢失了怎么办？

**A**: Token 无法找回，需要：
1. 解绑该浏览器
2. 重新绑定浏览器获取新 Token

### Q: 如何使用 Token？

**A**: 使用 Token 建立 SSE V2 连接：
```bash
curl -N -H "Authorization: Bearer <token>" \
  http://localhost:32122/sse-v2
```

---

## 性能优化

### 前端优化

- **最小化 DOM 操作**: 批量更新减少重绘
- **事件委托**: 表格使用事件委托
- **懒加载**: 按需加载浏览器列表

### 后端优化

- **静态文件缓存**: 自动设置 MIME 类型
- **路径解析缓存**: 复用解析结果
- **安全检查**: 提前验证路径

---

## 下一步

1. **添加功能**
   - [ ] 批量操作（批量删除）
   - [ ] 搜索和过滤
   - [ ] Token 刷新机制
   - [ ] 浏览器连接状态实时显示

2. **增强体验**
   - [ ] 暗色主题
   - [ ] 多语言支持
   - [ ] 键盘快捷键
   - [ ] 导出数据（CSV/JSON）

3. **监控分析**
   - [ ] 用户活动统计
   - [ ] Token 使用情况
   - [ ] 浏览器连接时长
   - [ ] API 调用日志

---

## 相关文档

- [V2 API 完成总结](./V2_API_COMPLETION_SUMMARY.md)
- [IDE 模拟测试结果](./IDE_SIMULATION_TEST_RESULT.md)
- [代码审查与优化](./CODE_REVIEW_AND_OPTIMIZATION.md)

---

**文档更新**: 2025-10-14  
**版本**: 0.8.8  
**作者**: Cascade AI
