#!/bin/bash

# 测试参数验证功能

BINARY="./dist/chrome-devtools-mcp-linux-x64"

echo "╔═══════════════════════════════════════════════════════════╗"
echo "║           参数验证测试                                    ║"
echo "╚═══════════════════════════════════════════════════════════╝"
echo ""

# 测试 1: 浏览器来源冲突
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "测试 1: 浏览器来源冲突 (--browserUrl + --channel)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
$BINARY --browserUrl http://localhost:9222 --channel canary 2>&1 | head -n 30
echo ""
read -p "按回车继续..."
echo ""

# 测试 2: stdio + port 冲突
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "测试 2: stdio 模式使用 --port (应该警告)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
timeout 3s $BINARY --port 3000 2>&1 | head -n 30
echo ""
read -p "按回车继续..."
echo ""

# 测试 3: browserUrl + headless 警告
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "测试 3: browserUrl + headless (应该警告)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
timeout 3s $BINARY --browserUrl http://localhost:9222 --headless 2>&1 | head -n 30
echo ""
read -p "按回车继续..."
echo ""

# 测试 4: 无效端口
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "测试 4: 无效端口号 (99999)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
$BINARY --transport sse --port 99999 2>&1 | head -n 30
echo ""
read -p "按回车继续..."
echo ""

# 测试 5: 正确配置
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "测试 5: 正确配置 (应该没有错误或警告)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
timeout 3s $BINARY --browserUrl http://localhost:9222 2>&1 | head -n 20
echo ""

echo "╔═══════════════════════════════════════════════════════════╗"
echo "║           测试完成                                        ║"
echo "╚═══════════════════════════════════════════════════════════╝"
